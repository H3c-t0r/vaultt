{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
~}}

{{#if (gt @byMonthActivityData.length 1)}}
  <div class="chart-wrapper stacked-charts" data-test-running-total="monthly-charts">
    <div class="single-chart-grid">
      <div class="chart-header has-bottom-margin-xl">
        <h2 class="chart-title">Vault client counts</h2>
        <p class="chart-description">
          The total billable clients in the specified date range. This includes unique entities, non-entity tokens, and
          secrets sync clients. The total client count number is an important consideration for Vault billing.
        </p>
      </div>

      <div class={{concat (unless @byMonthActivityData "chart-empty-state ") "chart-container-wide"}}>
        <Clients::LineChart @dataset={{@byMonthActivityData}} @upgradeData={{@upgradeData}} />
      </div>

      <div class="chart-subTitle">
        <StatText
          @label="Running client total"
          @subText="The number of clients which interacted with Vault during this date range."
          @value={{@runningTotals.clients}}
          @size="l"
        />
      </div>
      <div class="data-details-top has-top-padding-l">
        <div class="is-flex-row">
          <div data-test-running-total-entity>
            <h3 class="data-details">Entity clients</h3>
            <p class="data-details">
              {{format-number this.entityClientData.runningTotal}}
            </p>
          </div>

          <div class="has-left-margin-l" data-test-running-total-sync>
            <h3 class="data-details">Secrets sync clients</h3>
            <p class="data-details">
              {{format-number @runningTotals.secret_syncs}}
            </p>
          </div>
        </div>
      </div>

      <div class="data-details-bottom" data-test-running-total-nonentity>
        <h3 class="data-details">Non-entity clients</h3>
        <p class="data-details">
          {{format-number this.nonEntityClientData.runningTotal}}
        </p>
      </div>
    </div>
  </div>
{{else}}
  {{#if (and @isHistoricalMonth this.singleMonthData.new_clients.clients)}}
    <div class="chart-wrapper single-month-grid" data-test-running-total="single-month-stats">
      <div class="chart-header has-bottom-margin-sm">
        <h2 class="chart-title">Vault client counts</h2>
        <p class="chart-description">
          The total billable clients in the specified date range. This includes unique entities, non-entity tokens, and
          secrets sync clients. The total client count number is an important consideration for Vault billing.
        </p>
      </div>
      <div class="single-month-stats" data-test-new>
        <div class="single-month-section-title">
          <StatText
            @label="New clients"
            @subText="This is the number of clients which were created in Vault for the first time in the selected month."
            @value={{this.singleMonthData.new_clients.clients}}
            @size="l"
          />
        </div>
        <div class="single-month-breakdown-entity">
          <StatText @label="Entity clients" @value={{this.singleMonthData.new_clients.entity_clients}} @size="m" />
        </div>
        <div class="single-month-breakdown-nonentity">
          <StatText @label="Non-entity clients" @value={{this.singleMonthData.new_clients.non_entity_clients}} @size="m" />
        </div>
        <div class="single-month-breakdown-sync">
          <StatText @label="Secrets sync clients" @value={{this.singleMonthData.new_clients.secret_syncs}} @size="m" />
        </div>
      </div>
      <div class="single-month-stats" data-test-total>
        <div class="single-month-section-title">
          <StatText
            @label="Total monthly clients"
            @subText="This is the number of total clients which used Vault for the given month, both new and previous."
            @value={{this.singleMonthData.clients}}
            @size="l"
          />
        </div>
        <div class="single-month-breakdown-entity">
          <StatText @label="Entity clients" @value={{this.singleMonthData.entity_clients}} @size="m" />
        </div>
        <div class="single-month-breakdown-nonentity">
          <StatText @label="Non-entity clients" @value={{this.singleMonthData.non_entity_clients}} @size="m" />
        </div>
        <div class="single-month-breakdown-sync">
          <StatText @label="Secrets sync clients" @value={{this.singleMonthData.secret_syncs}} @size="m" />
        </div>
      </div>
    </div>
  {{else}}
    {{! This renders when either: 
    -> viewing the current month and all namespaces (no filters)
    -> filtering by a namespace with no month over month data
    if filtering by a mount with no month over month data <UsageStats> in dashboard.hbs renders }}
    <Clients::UsageStats
      @title="Total usage"
      @description="These totals are within this namespace and all its children. {{if
        @isCurrentMonth
        "Only totals are available when viewing the current month. To see a breakdown of new and total clients for this month, select the 'Current Billing Period' filter."
      }}"
      @totalUsageCounts={{@runningTotals}}
    />
  {{/if}}
{{/if}}