<div class="popup-menu-content">
  <div class="box">
    {{#unless this.version.isOSS}}
      {{#if (and this.activeCluster.unsealed this.auth.currentToken)}}
        {{#if @cluster.dr.isSecondary}}
          {{#if (has-permission "status" routeParams="replication")}}
            <nav class="menu" aria-label="replication secondary menu">
              <p class="menu-label">Replication</p>
              <ul>
                {{#if @cluster.anyReplicationEnabled}}
                  <li>
                    <button
                      class="link"
                      type="button"
                      disabled={{not this.auth.currentToken}}
                      {{on "click" (fn @onLinkClick (array "vault.cluster.replication-dr-promote.details"))}}
                    >
                      <ReplicationModeSummary @mode="dr" @display="menu" @cluster={{@cluster}} />
                    </button>
                  </li>
                {{/if}}
              </ul>
            </nav>
            <hr />
          {{/if}}
        {{else}}
          {{#if (has-permission "status" routeParams="replication")}}
            <nav class="menu" aria-label="replication menu">
              <p class="menu-label">Replication</p>
              <ul>
                {{#if @cluster.anyReplicationEnabled}}
                  <li>
                    <button
                      class="link"
                      type="button"
                      disabled={{not this.auth.currentToken}}
                      {{on "click" (fn @onLinkClick (array "vault.cluster.replication.mode.index" "dr"))}}
                    >
                      <ReplicationModeSummary @mode="dr" @display="menu" @cluster={{@cluster}} />
                    </button>
                  </li>
                  <li>
                    {{#if (has-feature "Performance Replication")}}
                      <button
                        class="link"
                        type="button"
                        disabled={{not this.auth.currentToken}}
                        {{on "click" (fn @onLinkClick (array "vault.cluster.replication.mode.index" "performance"))}}
                      >
                        <ReplicationModeSummary @mode="performance" @display="menu" @cluster={{@cluster}} @tagName="span" />
                      </button>
                    {{else}}
                      <ReplicationModeSummary @mode="performance" @display="menu" @cluster={{@cluster}} @class="menu-item" />
                    {{/if}}
                  </li>
                {{else}}
                  <li>
                    <button class="link" type="button" {{on "click" (fn @onLinkClick (array "vault.cluster.replication"))}}>
                      <div class="level is-mobile">
                        <span class="level-left">Enable</span>
                        <Icon @name="plus-circle" class="has-text-grey-light level-right" />
                      </div>
                    </button>
                  </li>
                {{/if}}
              </ul>
            </nav>
            <hr />
          {{/if}}
        {{/if}}
      {{/if}}
    {{/unless}}
    <nav class="menu" aria-label="server menu">
      <div class="menu-label">
        Server
      </div>
      <ul class="menu-list">
        <li class="action">
          {{#if this.activeCluster.unsealed}}
            {{#if (and (has-permission "status" routeParams="seal") (not @cluster.dr.isSecondary))}}
              <button
                class="link"
                type="button"
                {{on "click" (fn @onLinkClick (array "vault.cluster.settings.seal" @cluster.name))}}
              >
                <div class="level is-mobile">
                  <span class="level-left">Unsealed</span>
                  <Icon @name="check-circle" class="has-text-success level-right" />
                </div>
              </button>
            {{else}}
              <span class="menu-item">
                <div class="level is-mobile">
                  <span class="level-left">Unsealed</span>
                  <Icon @name="check-circle" class="has-text-success level-right" />
                </div>
              </span>
            {{/if}}
          {{else}}
            <span class="menu-item">
              <div class="level is-mobile">
                <span class="level-left has-text-danger">Sealed</span>
                <Icon @name="x-circle" class="has-text-danger level-right" />
              </div>
            </span>
          {{/if}}
        </li>
      </ul>
      {{#if
        (and
          (or
            (and this.version.features (has-permission "status" routeParams="license"))
            (and @cluster.usingRaft (has-permission "status" routeParams="raft"))
          )
          (not @cluster.dr.isSecondary)
        )
      }}
        <ul class="menu-list">
          {{#if (and this.version.features (has-permission "status" routeParams="license") (not @cluster.dr.isSecondary))}}
            <li class="action">
              <button
                class="link"
                type="button"
                {{on "click" (fn @onLinkClick (array "vault.cluster.license" this.activeCluster.name))}}
              >
                <div class="level is-mobile">
                  <span class="level-left">License</span>
                  <Chevron class="has-text-grey-light level-right" />
                </div>
              </button>
            </li>
          {{/if}}
          {{#if (and @cluster.usingRaft (has-permission "status" routeParams="raft"))}}
            <li class="action">
              {{! on click modifier breaks link in production builds on Ember 3.28.8  }}
              <button
                class="link"
                type="button"
                {{on "click" (fn @onLinkClick (array "vault.cluster.storage" this.activeCluster.name))}}
              >
                <div class="level is-mobile">
                  <span class="level-left">Raft Storage</span>
                  <Chevron class="has-text-grey-light level-right" />
                </div>
              </button>
            </li>
          {{/if}}
        </ul>
      {{/if}}
      {{#if (and (has-permission "clients" routeParams="activity") (not @cluster.dr.isSecondary) this.auth.currentToken)}}
        <ul class="menu-list">
          <li class="action">
            <button class="link" type="button" {{on "click" (fn @onLinkClick (array "vault.cluster.clients.current"))}}>
              <div class="level is-mobile">
                <span class="level-left">Client count</span>
                <Chevron class="has-text-grey-light level-right" />
              </div>
            </button>
          </li>
        </ul>
      {{/if}}
    </nav>
  </div>
</div>