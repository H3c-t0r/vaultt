{{#if @backend}}
  <form {{on "submit" this.createDistribution}} class="form-section" data-test-keymgmt-distribution-form>
    {{#unless @key}}
      <div class="field" data-test-keymgmt-dist-key>
        <SearchSelect
          @id="key"
          @models={{array "keymgmt/key"}}
          @onChange={{this.handleKeySelect}}
          @passObject={{true}}
          @inputValue={{this.formData.key}}
          @subText="Type to use the name of an existing key that youâ€™d like to add to this provider, or to create one."
          @wildcardLabel="key"
          @label=""
          @subLabel="Key name"
          @fallbackComponent="string-list"
          @selectLimit="1"
          @backend={{@backend}}
          @disallowNewItems={{false}}
        >
          {{#if (and this.validMatchError.key (not this.isNewKey))}}
            <AlertInline @paddingTop={{true}} @sizeSmall={{true}} @type="danger">
              {{this.validMatchError.key}}
              To check compatibility,
              <DocLink class="doc-link-subtle" @path="/docs/secrets/key-management#compatibility">refer to this table</DocLink>.
            </AlertInline>
          {{/if}}
        </SearchSelect>
      </div>
    {{/unless}}

    {{#if this.isNewKey}}
      <div class="field" data-test-keymgmt-dist-keytype>
        <label class="is-label" for="keyType">Key Type</label>
        <div class="control is-expanded">
          <div class="select is-fullwidth">
            <select
              name="keyType"
              id="keyType"
              {{on "change" this.handleKeyType}}
              class={{if this.validMatchError.key "has-error-border"}}
            >
              <option value="">
                Select one
              </option>
              {{#each this.keyTypes as |val|}}
                <option selected={{eq this.keyType val}} value={{val}}>
                  {{val}}
                </option>
              {{/each}}
            </select>
          </div>
          {{#if this.validMatchError.key}}
            <AlertInline @paddingTop={{true}} @sizeSmall={{true}} @type="danger">
              {{this.validMatchError.key}}
              To check compatibility,
              <DocLink class="doc-link-subtle" @path="/docs/secrets/key-management#compatibility">refer to this table</DocLink>.
            </AlertInline>
          {{/if}}
        </div>
      </div>
    {{/if}}

    {{#unless @provider}}
      <div class="field" data-test-keymgmt-dist-provider>
        <label class="is-label" for="provider">Provider</label>
        <div class="control is-expanded">
          <div class="select is-fullwidth">
            <select
              name="provider"
              id="provider"
              {{on "change" this.handleProvider}}
              class={{if this.validMatchError.provider "has-error-border"}}
            >
              <option value="">
                Select provider
              </option>
              {{#each @providers as |val|}}
                <option selected={{eq @model.provider val}} value={{val}}>
                  {{val}}
                </option>
              {{/each}}
            </select>
          </div>
        </div>
        {{#if this.validMatchError.provider}}
          <AlertInline @paddingTop={{true}} @sizeSmall={{true}} @type="danger">
            {{this.validMatchError.provider}}
            To check compatibility,
            <DocLink class="doc-link-subtle" @path="/docs/secrets/key-management#compatibility">refer to this table</DocLink>.
          </AlertInline>
        {{/if}}
      </div>
    {{/unless}}

    <fieldset
      class="field form-fieldset"
      id="operations"
      disabled={{or (not this.formData.provider) (not this.keyModel.type) this.validMatchError}}
      data-test-keymgmt-dist-operations
    >
      <legend class="is-label">Operations</legend>
      {{!-- {{#each-in fieldGroup as |group fields|}} --}}
      {{#each this.operations as |op|}}
        <div class="b-checkbox">
          <Input @type="checkbox" id={{op}} class="styled" @checked={{false}} {{on "input" this.handleOperation}} />
          <label for={{op}}>{{capitalize op}}</label>
        </div>
      {{/each}}
    </fieldset>

    <fieldset class="field form-fieldset" id="protection" data-test-keymgmt-dist-protections>
      <legend class="is-label">Protection</legend>
      <div>
        <RadioButton
          @value="hsm"
          @radioClass="radio"
          @groupValue={{this.formData.protection}}
          @name="hsm"
          @radioId="protection-hsm"
        />
        <label for="protection-hsm">HSM</label>
      </div>
      <div>
        <RadioButton
          @value="software"
          @radioClass="radio"
          @groupValue={{this.formData.protection}}
          @name="software"
          @radioId="protection-software"
        />
        <label for="protection-software">Software</label>
      </div>
    </fieldset>

    <div>
      <input type="submit" value="Distribute key" />
    </div>
  </form>
{{/if}}