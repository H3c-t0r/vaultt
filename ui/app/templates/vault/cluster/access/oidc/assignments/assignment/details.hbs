<PageHeader as |p|>
  <p.top>
    <nav class="breadcrumb" aria-label="breadcrumbs">
      <ul>
        <li>
          <span class="sep">&#x0002f;</span>
          <LinkTo @route="vault.cluster.access.oidc.assignments">
            Assignments
          </LinkTo>
        </li>
      </ul>
    </nav>
  </p.top>
  <p.levelLeft>
    <h1 class="title is-3">
      {{this.model.name}}
    </h1>
  </p.levelLeft>
</PageHeader>

<div class="tabs-container box is-sideless is-fullwidth is-paddingless is-marginless">
  <nav class="tabs" aria-label="tabs">
    <ul>
      <LinkTo
        @route="vault.cluster.access.oidc.assignments.assignment.details"
        @model={{@model}}
        @query={{hash listEntities=false listGroups=false}}
      >
        Details
      </LinkTo>
      <LinkTo
        @route="vault.cluster.access.oidc.assignments.assignment.details"
        @model={{@model}}
        @query={{hash listEntities=true listGroups=false}}
      >
        Entities
      </LinkTo>
      <LinkTo
        @route="vault.cluster.access.oidc.assignments.assignment.details"
        @model={{@model}}
        @query={{hash listEntities=false listGroups=true}}
      >
        Groups
      </LinkTo>
    </ul>
  </nav>
</div>

<Toolbar>
  {{#if (or (not-eq this.listEntities) (not-eq this.listGroups))}}
    <ToolbarActions>
      {{#if this.model.canDelete}}
        <ConfirmAction
          @buttonClasses="toolbar-link"
          @onConfirmAction={{this.delete}}
          @confirmTitle="Delete assignment?"
          @confirmMessage="This assignment will be permanently deleted. You will not be able to recover it."
          @confirmButtonText="Delete"
        >
          Delete assignment
        </ConfirmAction>
      {{/if}}
      {{#if this.model.canEdit}}
        <ToolbarLink @params={{array "vault.cluster.access.oidc.assignments.assignment.edit" this.model.name}}>
          Edit assignment
        </ToolbarLink>
      {{/if}}
    </ToolbarActions>
  {{/if}}
</Toolbar>

<div class="box is-fullwidth is-sideless is-paddingless is-marginless">
  {{! queryParams come in as strings so much check against value of string not boolean }}
  {{#if (and (eq this.listEntities "false") (eq this.listGroups "false"))}}
    <InfoTableRow @label="Name" @value={{this.model.name}} />
  {{/if}}
  {{#if (eq this.listEntities "true")}}
    {{! ARG TODO need this to be an array of objects with name and id }}
    {{#each this.model.entityIds as |entity|}}
      <LinkedBlock
        class="list-item-row {{if (eq entity.name 'allow_all') 'is-disabled'}}"
        @params={{array "vault.cluster.access.oidc.assignments.assignment.details" entity.name}}
        @disabled={{eq entity.name "allow_all"}}
      >
        <div class="level is-mobile">
          <div class="level-left">
            <div>
              <Icon @name="users" class="has-text-grey-light" />
              <span class="has-text-weight-semibold {{if (not-eq entity.name 'allow_all') 'is-underline'}}">
                {{entity.name}}
              </span>
              {{#if (eq entity.name "allow_all")}}
                <div class="is-size-8">
                  This is a built-in assignment that cannot be modified or deleted.
                  <DocLink @path="/docs/concepts/oidc-provider#assignments">
                    Learn more
                  </DocLink>
                </div>
              {{/if}}
            </div>
          </div>
        </div>
      </LinkedBlock>
    {{/each}}
  {{/if}}
  {{#if (eq this.listGroups "true")}}
    {{#each this.model.groupIds as |group|}}
      <LinkedBlock
        class="list-item-row {{if (eq group.name 'allow_all') 'is-disabled'}}"
        @params={{array "vault.cluster.access.oidc.assignments.assignment.details" group.name}}
        @disabled={{eq group.name "allow_all"}}
      >
        <div class="level is-mobile">
          <div class="level-left">
            <div>
              <Icon @name="users" class="has-text-grey-light" />
              <span class="has-text-weight-semibold {{if (not-eq group.name 'allow_all') 'is-underline'}}">
                {{group.name}}
              </span>
              {{#if (eq group.name "allow_all")}}
                <div class="is-size-8">
                  This is a built-in assignment that cannot be modified or deleted.
                  <DocLink @path="/docs/concepts/oidc-provider#assignments">
                    Learn more
                  </DocLink>
                </div>
              {{/if}}
            </div>
          </div>
        </div>
      </LinkedBlock>
    {{/each}}
  {{/if}}
</div>
{{! ARG TODO empty state }}