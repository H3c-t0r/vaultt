<Toolbar>
  <ToolbarFilters>
    <Toggle
      data-test-json-view-toggle
      @name="json"
      @status="success"
      @size="small"
      @checked={{this.showJsonView}}
      @onChange={{this.toggleJsonView}}
    >
      <span class="has-text-grey">JSON</span>
    </Toggle>
  </ToolbarFilters>
</Toolbar>

<form {{on "submit" (perform this.save)}}>
  <div class="box is-sideless is-fullwidth is-bottomless">
    <NamespaceReminder @mode="create" @noun="secret" />
    <MessageError @model={{@secret}} @errorMessage={{this.errorMessage}} />

    {{#let (find-by "name" "path" @secret.allFields) as |attr|}}
      <FormField
        @attr={{attr}}
        @model={{@secret}}
        @modelValidations={{this.modelValidations}}
        @onKeyUp={{this.keyUpValidations}}
      />
    {{/let}}

    <hr class="is-marginless has-background-gray-200" />
    {{#if this.showJsonView}}
      <JsonEditor
        @title="Secret data"
        @value={{or (stringify @secret.secretData) this.emptyJson}}
        @valueUpdated={{this.handleJson}}
      />
    {{else}}
      <KvObjectEditor
        class="has-top-margin-m"
        @label="Secret data"
        @value={{@secret.secretData}}
        @onChange={{fn (mut @secret.secretData)}}
        @maskedInput={{true}}
      />
    {{/if}}
  </div>
  <div class="box is-fullwidth is-bottomless">
    <div class="control">
      <button
        type="submit"
        class="button is-primary {{if this.save.isRunning 'is-loading'}}"
        disabled={{this.save.isRunning}}
        data-test-kv-secret-save
      >
        Save
      </button>
      <button
        type="button"
        class="button has-left-margin-s"
        disabled={{this.save.isRunning}}
        {{on "click" this.cancel}}
        data-test-kv-secret-cancel
      >
        Cancel
      </button>
    </div>
    {{#if this.invalidFormAlert}}
      <AlertInline class="has-top-padding-s" @type="danger" @message={{this.invalidFormAlert}} @mimicRefresh={{true}} />
    {{/if}}
  </div>
</form>