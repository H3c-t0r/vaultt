<KvPageHeader @breadcrumbs={{@breadcrumbs}} @model={{@model}} @pageTitle={{@path}}>
  <:tabLinks>
    <LinkTo @route="secret.details" data-test-secrets-tab="Secret">Secret</LinkTo>
    <LinkTo @route="secret.metadata.index" data-test-secrets-tab="Metadata">Metadata</LinkTo>
    <LinkTo @route="secret.metadata.versions" data-test-secrets-tab="Version History">Version History</LinkTo>
    <LinkTo @route="secret.metadata.diff" data-test-secrets-tab="Version Diff">Version Diff</LinkTo>
  </:tabLinks>

  <:toolbarFilters>
    {{! left side version selector }}
    <BasicDropdown @class="popup-menu" @horizontalPosition="auto-right" @verticalPosition="below" as |D|>
      <D.Trigger data-test-version-dropdown class="toolbar-link {{if D.isOpen ' is-active'}}">
        Version
        {{this.leftSideVersion}}
        <Chevron @direction="down" @isButton={{true}} />
      </D.Trigger>
      <D.Content @defaultClass="popup-menu-content">
        <nav class="box menu" aria-label="version-left">
          <ul class="menu-list">
            {{#each @metadata.sortedVersions as |versionData|}}
              <li>
                <button
                  type="button"
                  class="link"
                  {{on "click" (fn this.selectVersion versionData.version D.actions "left")}}
                  disabled={{(or versionData.destroyed versionData.deletion_time)}}
                >
                  Version
                  {{versionData.version}}
                  {{#if (eq versionData.version this.leftSideVersion)}}
                    <Icon @name="check-circle" class="has-text-success is-pulled-right" />
                  {{else if versionData.destroyed}}
                    <Icon @name="x-square-fill" class="has-text-danger is-pulled-right" />
                  {{else if versionData.deletion_time}}
                    <Icon @name="x-square-fill" class="has-text-grey is-pulled-right" />
                  {{/if}}
                </button>
              </li>
            {{/each}}
          </ul>
        </nav>
      </D.Content>
    </BasicDropdown>
    {{! right side version selector }}
    <BasicDropdown @class="popup-menu" @horizontalPosition="auto-right" @verticalPosition="below" as |D|>
      <D.Trigger data-test-version-dropdown class="toolbar-link {{if D.isOpen ' is-active'}}">
        Version
        {{this.rightSideVersion}}
        <Chevron @direction="down" @isButton={{true}} />
      </D.Trigger>
      <D.Content @defaultClass="popup-menu-content">
        <nav class="box menu" aria-label="version-right">
          <ul class="menu-list">
            {{#each @metadata.sortedVersions as |versionData|}}
              <li>
                <button
                  type="button"
                  class="link"
                  {{on "click" (fn this.selectVersion versionData.version D.actions "right")}}
                  disabled={{(or versionData.destroyed versionData.deletion_time)}}
                >
                  Version
                  {{versionData.version}}
                  {{#if (eq versionData.version this.rightSideVersion)}}
                    <Icon @name="check-circle" class="has-text-success is-pulled-right" />
                  {{else if versionData.destroyed}}
                    <Icon @name="x-square-fill" class="has-text-danger is-pulled-right" />
                  {{else if versionData.deletion_time}}
                    <Icon @name="x-square-fill" class="has-text-grey is-pulled-right" />
                  {{/if}}
                </button>
              </li>
            {{/each}}
          </ul>
        </nav>
      </D.Content>
    </BasicDropdown>
    {{! status icon }}
    {{#if this.statesMatch}}
      <div class="has-left-padding-s">
        <Icon @name="check-circle-fill" class="has-text-success" />
        <span>States match</span>
      </div>
    {{/if}}
  </:toolbarFilters>
</KvPageHeader>

<div class="form-section visual-diff text-grey-lightest background-color-black">
  <pre>{{sanitized-html this.visualDiff}}</pre>
</div>