<PageHeader as |p|>
  <p.top>
    <Page::Breadcrumbs @breadcrumbs={{@breadcrumbs}} />
  </p.top>
  <p.levelLeft>
    <h1 class="title is-3" data-test-pki-page-title>
      {{this.title}}
    </h1>
  </p.levelLeft>
</PageHeader>

{{#unless this.newRootModel.id}}
  <div class="box is-bottomless is-marginless is-flex-start">
    {{#each this.rotationOptions as |option|}}
      <RadioCard
        class="has-fixed-width"
        @title={{option.label}}
        @description={{option.description}}
        @icon="list"
        @value={{option.key}}
        @groupValue={{this.rotateForm}}
        @onChange={{fn (mut this.rotateForm) option.key}}
        data-test-radio={{option.key}}
      />
    {{/each}}
  </div>
{{/unless}}

{{#if (eq this.rotateForm "use-old-settings")}}
  <h2 class="title is-size-5 has-border-bottom-light">
    Root parameters
  </h2>
  {{#let (find-by "name" "commonName" this.newRootModel.allFields) as |attr|}}
    <FormField data-test-field={{attr}} @attr={{attr}} @model={{this.newRootModel}} @showHelpText={{false}} />
  {{/let}}
  {{#let (find-by "name" "issuerName" this.newRootModel.allFields) as |attr|}}
    <FormField data-test-field={{attr}} @attr={{attr}} @model={{this.newRootModel}} @showHelpText={{false}} />
  {{/let}}
  <div class="box has-slim-padding is-shadowless">
    <ToggleButton
      @closedLabel="Old root settings"
      @openLabel="Hide old root settings"
      @isOpen={{this.showOldSettings}}
      @onClick={{fn (mut this.showOldSettings)}}
    />
    {{#if this.showOldSettings}}
      <PkiIssuerInfoRows @issuer={{@oldRoot}} />
    {{/if}}
  </div>
{{else}}
  <PkiGenerateRoot
    @model={{this.newRootModel}}
    @onCancel={{transition-to "vault.cluster.secrets.backend.pki.issuers.issuer.details"}}
    @onComplete={{transition-to "vault.cluster.secrets.backend.pki.issuers.index"}}
    @onSave={{fn (mut this.title) "View rotated root"}}
    @adapterOptions={{hash actionType="rotate-root"}}
  />
{{/if}}