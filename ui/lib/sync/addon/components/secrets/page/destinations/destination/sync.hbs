{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
~}}

<SyncHeader
  @title="Sync secrets to {{@destination.typeDisplayName}}"
  @breadcrumbs={{array
    (hash label="Secrets sync" route="secrets.overview")
    (hash label="Destinations" route="secrets.destinations")
    (hash label="Destination" route="secrets.destinations.destination")
    (hash label="Sync")
  }}
/>

<form {{on "submit" (perform this.setAssociation)}} class="has-top-margin-xl">
  <p class="is-label">Which secrets would you like us to sync?</p>
  <p class="sub-text">
    Select a KV engine mount and path to sync a secret to the destination.
  </p>

  <MessageError @errorMessage={{this.error}} />

  <div class="has-top-margin-l">
    {{#if this.mounts}}
      <SearchSelect
        @label="Select a mount for the KV engine"
        @options={{this.mounts}}
        @selectLimit={{1}}
        @disallowNewItems={{true}}
        @onChange={{this.setMount}}
        data-test-sync-mount-select
      />
    {{else}}
      <FormFieldLabel @label="Enter an existing KV engine mount" />
      <FilterInput
        placeholder="KV engine mount path"
        value={{this.mountPath}}
        @onInput={{this.onMountInput}}
        data-test-sync-mount-input
      />
    {{/if}}

    <FormFieldLabel
      @label="Select a secret to sync"
      @subText="Enter the full path to the secret. Suggestions will display below if permitted by policy."
    />
    <FilterInput
      placeholder="Path to secret"
      value={{this.secretPath}}
      disabled={{not this.mountPath}}
      @onInput={{this.onSecretInput}}
      {{on "click" this.onSecretInputClick}}
      data-test-sync-secret-input
    />
    <PowerSelect
      @eventType="click"
      @options={{this.secrets}}
      @onChange={{this.onSuggestionSelect}}
      @renderInPlace={{true}}
      @closeOnSelect={{false}}
      @disabled={{not this.mountPath}}
      @registerAPI={{fn (mut this.powerSelectAPI)}}
      @triggerClass="is-hidden"
      @noMatchesMessage="No suggestions for this path"
      data-test-sync-secret-select
      as |secret|
    >
      {{secret.path}}
    </PowerSelect>

    <div class="field is-grouped-split box is-fullwidth is-bottomless has-top-margin-xxxl">
      <Hds::ButtonSet>
        <Hds::Button
          @text="Sync to destination"
          @color="primary"
          @icon={{if this.setAssociation.isRunning "loading"}}
          type="submit"
          disabled={{or (not (and this.mountPath this.secretPath)) this.setAssociation.isRunning}}
          data-test-sync-submit
        />
        <Hds::Button @text="Cancel" @color="secondary" {{on "click" this.cancel}} data-test-sync-cancel />
      </Hds::ButtonSet>
    </div>
  </div>
</form>