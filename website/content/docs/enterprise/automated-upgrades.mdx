---
layout: docs
page_title: Vault Enterprise Automated Upgrades
description: |-
  Vault Enterprise can upgrade itself automatically.
---

# Automated Upgrades

~> **Note**: Automated Upgrades requires [Vault Enterprise](https://www.hashicorp.com/products/vault/) to be 
configured to use Integrated Storage.

Vault Enterprise Automated Upgrades allows operators to upgrade the Vault version currently running in a cluster automatically. 
 There are a few different ways to make this upgrade happen,
and control which versions are being upgraded to. With no additional configuration,
Vault will check the version of Vault that each node in the cluster is running. If a blue/green
style deployment is desired, Vault uses the version of your choosing, regardless of
which version of Vault is currently running.

## Configuration
A new key can be added to Vault's `storage` configuration stanza: `autopilot_upgrade_version`.
The value for this key is a [SemVer](https://semver.org/) compatible version string of your choosing.
When a version string is present, it will override the current version of Vault that is running to upgrade automatically.

## Mechanics
Regardless of whether you choose to use Vault's built-in version, or a version of your choosing, the
mechanics for performing an automated upgrade are the same. Once you have a Vault cluster running,
start and join a number of new nodes to the cluster, running the updated version. Once the number of
nodes running the new version equals or exceeds the number of nodes running the old version, the
Autopilot subsystem within Vault will promote the new version nodes to become voters, demote the old
version nodes to become non-voters, transfer leadership from the old leader to a randomly selected
node running the new version, and wait for you to remove the old version nodes from the cluster.

Below is a flowchart depicting Autopilot's automated upgrade state machine.

![Automated Upgrade State Machine](/img/autopilot-automated-upgrade.png)

The status of the automated upgrade can be monitored by consulting the [Autopilot state API endpoint](/api-docs/system/storage/raftautopilot#get-cluster-state).

## Examples
### Using Vault's built-in version
This is the easiest to perform an automated upgrade. No configuration is needed. Automated upgrades
are enabled by default. Following the procedure outlined above in the [Mechanics](#mechanics) section
is enough to make this happen.

### Using a blue/green style deploy
Specify something like: `1.11.0-release.1` for the `autopilot_upgrade_version` configuration key in your
existing cluster. When you're ready to deploy a new set of nodes, specify `1.11.0-release.2` for the new
nodes. Any time you need to deploy an updated set of nodes to the cluster, increment the final number.
