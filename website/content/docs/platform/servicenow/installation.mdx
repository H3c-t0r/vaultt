---
layout: docs
page_title: Install Vault ServiceNow Credential Resolver
description: Installation steps for the Vault ServiceNow Credential Resolver.
---

# Installing the Vault Credential Resolver

## Prerequisites

* ServiceNow version Quebec+ (untested on previous versions)
* MID server version Quebec+ (untested on previous versions)
* Discovery and external credential plugins activated on ServiceNow
* Working Vault deployment accessible from the MID server

## Installing Vault Agent

* Select your desired auth method from Agent's [supported auth methods](/docs/agent/autoauth/methods)
  and set it up in Vault
  * For example, to set up AppRole auth and a role called `role1` with the `demo` policy attached:

    ```bash
    vault auth enable approle
    vault write auth/approle/role/role1 bind_secret_id=true token_policies=demo
    ```

  * To get the values required for files `/vault/config/roleID` and
    `/vault/config/secretID` referenced in the config below, you could then run:

    ```bash
    roleID=$(vault read -format json auth/approle/role/role1/role-id | jq -r '.data.role_id')
    secretID=$(vault write -format json -f auth/approle/role/role1/secret-id | jq -r '.data.secret_id')
    ```

* Create an `agent.hcl` config file. Your exact configuration may vary, but you
  must set `cache.use_auto_auth_token = true`, and the `listener`, `vault` and
  `auto_auth` blocks are also required to set up a working Agent, e.g.:

  ```
  listener "tcp" {
    address = "127.0.0.1:8200"
    tls_disable = true
  }

  cache {
    use_auto_auth_token = true
  }

  vault {
    address = "http://vault.example.com:8200"
  }

  auto_auth {
      method {
          type = "approle"
          config = {
              role_id_file_path = "/vault/config/roleID"
              secret_id_file_path = "/vault/config/secretID"
          }
      }
  }
  ```

  * Install Agent as service running `vault agent -config=/path/to/agent.hcl`
    * Documentation for Windows service installation [here](/docs/agent/winsvc)

## Uploading JAR file to MID server

* Download the Vault Credential Resolver JAR file from **TBD**
* In ServiceNow, navigate to "MID server - JAR files" -> New
  * Manage Attachments -> upload Vault Credential Resolver JAR
  * Fill in name, version etc as desired
  * Click Submit
* Navigate to "MID server - Properties" -> New
  * Set Name: `mid.external_credentials.vault.address`, Value: Address of Vault
    Agent listener from previous step, e.g. `http://127.0.0.1:8200`
  * **Optional:** Set another property `mid.external_credentials.vault.ca` if
    using TLS between the MID server and Vault Agent

## Configuring discovery credentials

* Navigate to "Discovery - Credentials" -> New
  * Select a type from the list
  * Tick "External credential store"
  * Fill in a meaningful name
  * Set "Credential ID" to the path in Vault where your secret is located, e.g.
    for a KV v2 secret engine mounted at "secret", you might have a secret stored
    under "ssh": `secret/data/ssh`. Check the [API docs](/api-docs/secret/) for
    your secret engine if you are unsure of the path to use
  * **Optional:** Click "Test credential" and select a MID server and a target
    to test against to test everything is working