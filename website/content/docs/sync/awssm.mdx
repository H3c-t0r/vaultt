---
layout: docs
page_title: AWS Secrets Manager - Secrets Sync Destination
description: The AWS Secrets Manager destination syncs secrets from Vault to AWS.
---

# AWS Secrets Manager

The AWS Secrets Manager destination enables Vault to sync and unsync secrets of your choosing into
an external AWS account. When configured, Vault will actively maintain the state of each externally-synced
secret in near-realtime. This includes sending new secrets, updating existing secret values, and removing
secrets when they either get dissociated from the destination or deleted from Vault. This enables the
ability to keep control of all your secrets localized while leveraging the benefits of the AWS Secrets Manager.

## Setup

The use of this sync destination requires prerequesite setup before beginning to configure it. Either an IAM
User or an IAM role must be set with the necessary policies in order for Vault to manage secrets in the
external destination. It is this IAM User or IAM Role in AWS for which access credentials will be generated,
then provided to Vault during configuration.

The following is an example policy outlining the required permissions to use secrets syncing:
```
{
	"Version": "2012-10-17",
	"Statement": [
    	{
    		"Effect": "Allow",
    		"Action": [
    			"secretsmanager:Create*",
    			"secretsmanager:Update*",
    			"secretsmanager:Delete*",
    			"secretsmanager:TagResource"
    		],
    		"Resource": "arn:aws:secretsmanager:*:*:secret:vault*"
    	}
	]
}
```

## Usage

Once AWS credentials have been obtained, configure Vault with them to create an AWS destination. If
you do not already have a KVv2 ready to use, mount a new KVv2 secrets engine and create a secret.

1. Mount the secret engine:
	```shell-session
	$ vault secrets enable -path=my-kv kv-v2
	```
	Output:
	```text
	Success! Enabled the kv-v2 secrets engine at: my-kv/
	```

1. Create a KV secret:
	```shell-session
	$ vault kv put -mount=my-kv my-secret foo=bar
	```
	Output:
	```text
	==== Secret Path ====
	my-kv/data/my-secret
	======= Metadata =======
	Key                Value
	---                -----
	created_time       2023-09-19T13:17:23.395109Z
	custom_metadata    <nil>
	deletion_time      n/a
	destroyed          false
	version            1
	```

1.	Configure the sync destination:

	```shell-session
	$ vault write sys/sync/destinations/aws-sm/my-awssm-1 \
	access_key_id='AKIAJWVN5Z4FOFT7NLNA' \
	secret_access_key='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' \
	region='us-east-1'
	```
	Output:
	```text
	Key                   Value
	---                   -----
	connection_details    map[access_key_id:***** region:us-east-1 secret_access_key:*****]
	name                  my-awssm-1
	type                  aws-sm
	```

1.	Set a secret to be associated with this AWS SM destination:
	```shell-session
	$ vault write sys/sync/destinations/aws-sm/my-awssm-1/associations/set \
	mount='my-kv' \
	secret_name='my-secret'
	```
	Output:
	```
	Key                   Value
	---                   -----
	associated_secrets    map[kv_37993f8a/my-secret:map[accessor:kv_37993f8a secret_name:my-secret sync_status:SYNCED updated_at:2023-09-19T13:17:35.085581-05:00]]
	store_name            aws1
	store_type            aws-sm
	```

1. Navigate to the [Secrets Manager](https://console.aws.amazon.com/secretsmanager/) in the AWS console
	to confirm your secret was successfully synced.

	Moving forward, any modification on the Vault secret will be propagated to its AWS Secrets Manager
	counterpart. Creating a new secret version in Vault will update the one in AWS to the new version. Deleting either
	the secret or the association in Vault will delete the secret in your AWS account as well.

1. Delete the secret association:
	```shell-session
	$ vault write sys/sync/destinations/aws-sm/my-awssm-1/associations/remove \
	mount='my-kv' \
	secret_name='my-secret'
	```
	Output:
	```text
	Key                   Value
	---                   -----
	associated_secrets    map[]
	store_name            aws1
	store_type            aws-sm
	```

## Troubleshooting

### Synced secrets not appearing in AWS Secrets Manager

Ensure that you are looking at the correct region in AWS, especially if using the web console.
The region you synced your secrets to must match the region you are trying to read them from.

### Error: unauthorized request: UnrecognizedClientException: The security token included in the request is invalid.

Ensure you are not using short-lived credentials with secrets syncing. By nature of the feature,
the credentials used by Vault to keep secrets synced must be long-lived.

## API

The AWS Secrets Manager destination has a full HTTP API. Please see the [secrets sync API](/vault/api-docs/system/secrets-sync) for more details.
