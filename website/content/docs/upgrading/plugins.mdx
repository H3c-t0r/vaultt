---
layout: docs
page_title: Upgrading Plugins - Guides
description: These are general upgrade instructions for Vault plugins.
---

# Upgrading Vault Plugins

The following procedure details steps for upgrading an external plugin that has
already been registered to the catalog on a running server. This procedure is
applicable to secret engines, auth methods, and database plugins.

## Upgrade Procedure

Vault executes plugin binaries when they are configured and roles are established
around them. The binary cannot be modified or replaced while running, so
upgrades cannot be performed by simply swapping the binary and updating the hash
in the plugin catalog.

Instead, you can restart or reload a plugin with the
`sys/plugins/reload/backend` [API][plugin_reload_api]. Follow these steps to
replace or upgrade a Vault plugin binary:

1. [Register][plugin_registration] `my-db-plugin-v1` to the catalog

```shell-session
$ vault plugin register -sha256=<SHA256 Hex value of the plugin binary> \
    secret \                  # type
    `my-db-plugin-v1`

Success! Registered plugin: my-db-plugin-v1
```

2. [Mount][plugin_management] the plugin backend

```shell-session
$ vault secrets enable database
Success! Enabled the database secrets engine at: database/
```

3. Register `my-db-plugin-v2` to the catalog under the same plugin name, but with
   updated command to run `my-db-plugin-v2` and updated sha256 of `my-db-plugin-v2`

```shell-session
$ vault plugin register -sha256=<SHA256 Hex value of the plugin binary> \
    secret \                  # type
    `my-db-plugin-v2`

Success! Registered plugin: my-db-plugin-v2
```

4. Trigger a plugin reload with `sys/plugins/reload/backend` to reload all
   mounted backends using that plugin or a subset of the mounts using that plugin
   with either the `plugin` or `mounts` parameter respectively.

```shell-session
$ vault plugin reload -plugin my-db-plugin-v2
Success! Reloaded plugin: my-db-plugin-v2
```

Until step 4, the mount will still use `my-db-plugin-v1`, and when the reload is
triggered, Vault will kill `my-db-plugin-v1`â€™s process and start a `my-db-plugin-v2`
process.

-> **Important:** Plugin reload of a new plugin binary must be
performed on each Vault instance. Performing a plugin upgrade on a single
instance or through a load balancer can result in mismatched
plugin binaries within a cluster. On a replicated cluster this may be accomplished
by setting the 'scope' parameter of the reload to 'global'.

[plugin_reload_api]: /api-docs/system/plugins-reload-backend
[plugin_registration]: /docs/plugins/plugin-architecture#plugin-registration
[plugin_management]: /docs/plugins/plugin-management#enabling-disabling-external-plugins
