### Internal error when vault policy in namespace does not exist
If a user is a member of a group that gets a policy from a 
namespace other than the one they’re trying to log into, 
and that policy doesn’t exist, Vault returns an internal error. 
This impacts all auth methods.

#### Affected versions
- 1.13.8 and 1.13.9
- 1.14.4 and 1.14.5
- 1.15.0 and 1.15.1

A fix will be released in Vault 1.15.2, 1.14.6, and 1.13.10.

### Workaround
During authentication, Vault derives inherited policies based on the groups an
entity belongs to. Vault returns an internal error when attaching the derived
policy to a token when:

1. the token belongs to a different namespace than the one handling
   authentication, and
1. the derived policy does not exist under the namespace.


You can resolve the error by adding the policy to the relevant namespace or
deleting the group policy mapping that uses the derived policy.

As an example, consider the following userpass auth method failure. The error is
likely due to the fact that Vault expects a group policy under the namespace for
`user1` that does not exist.

<CodeBlockConfig hideClipboard>

```shell-session
# Failed login
$ vault login -method=userpass username=user1 password=123
Error authenticating: Error making API request.

URL: PUT http://127.0.0.1:8200/v1/auth/userpass/login/user1
Code: 500. Errors:

* internal error

# Identify the entity and group IDs
$ vault read -format=json identity/entity/name/user1 | jq '{"entity_id": .data.id, "group_ids": .data.group_ids} '
{
  "entity_id": "420c82de-57c3-df2e-2ef6-0690073b1636",
  "group_ids": [
    "6cb152b7-955d-272b-4dcf-a2ed668ca1ea"
  ]
}

# Fetch the group from the other namespace
$ vault read -format=json -namespace=ns1 identity/group/id/6cb152b7-955d-272b-4dcf-a2ed668ca1ea | jq '.data.policies'
[
  "group_policy"
]

# The only policy in this namespace is default (group_policy is missing)
$ vault policy list -namespace=ns1
default

# Option 1: Remove the missing policy from the group
$ vault write -namespace=ns1 identity/group/id/6cb152b7-955d-272b-4dcf-a2ed668ca1ea name="test" policies="default"

# OR Option 2: Create the missing policy
$ vault policy write -namespace=ns1 group_policy - << EOF
    path "secret/data/*" {
	    capabilities = ["create", "update"]
    }
EOF

# Login should succeed now
$ vault login -method=userpass username=user1 password=123`
```